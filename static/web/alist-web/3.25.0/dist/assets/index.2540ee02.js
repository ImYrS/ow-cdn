import{aq as z,bg as D,bB as m,a5 as H,N as k,j as s,Z as $,as as ee,H as I,u as U,i as te,ai as re,bx as O,bC as A,bj as F,bt as ne,bD as oe,bE as ie,bF as se,d as ae,w as le,e as h,bG as ce,a as ue,X as fe,bs as C,af as ge,br as de,r as pe,I as x,bH as he,aP as me,a1 as we,B as S,a_ as ve,a$ as be,al as $e,h as Ce,n as R}from"./index.be808c1f.js";import{p as xe,c as Se}from"./index.3f8a9893.js";const _e=e=>{const r=new DataView(e);let t="";for(let n=0;n<r.byteLength;n+=4)t+=r.getUint32(n).toString(16).padStart(8,"0");return t},ye=e=>async(r,{outputFormat:t="hex"}={})=>{typeof r=="string"&&(r=new globalThis.TextEncoder().encode(r));const n=await globalThis.crypto.subtle.digest(e,r);return t==="hex"?_e(n):n},_=ye("SHA-256");function j(e){return Object.prototype.toString.call(e).slice(8,-1)}function ke(e){if(j(e)!=="Object")return!1;const r=Object.getPrototypeOf(e);return!!r&&r.constructor===Object&&r===Object.prototype}function E(e){return ke(e)}function G(e){return j(e)==="Array"}function Ie(e){return j(e)==="Symbol"}var V=function(e){return function(r,t,n){return e(r,t,n)*n}},P=function(e,r){if(e)throw Error("Invalid sort config: "+r)},Z=function(e){var r=e||{},t=r.asc,n=r.desc,o=t?1:-1,a=t||n;P(!a,"Expected `asc` or `desc` property"),P(t&&n,"Ambiguous object with `asc` and `desc` config properties");var i=e.comparer&&V(e.comparer);return{order:o,sortBy:a,comparer:i}},Oe=function(e){return function r(t,n,o,a,i,c,l){var u,f;if(typeof t=="string")u=c[t],f=l[t];else if(typeof t=="function")u=t(c),f=t(l);else{var d=Z(t);return r(d.sortBy,n,o,d.order,d.comparer||e,c,l)}var p=i(u,f,a);return(p===0||u==null&&f==null)&&n.length>o?r(n[o],n,o+1,a,i,c,l):p}};function q(e,r,t){if(e===void 0||e===!0)return function(a,i){return r(a,i,t)};if(typeof e=="string")return P(e.includes("."),"String syntax not allowed for nested properties."),function(a,i){return r(a[e],i[e],t)};if(typeof e=="function")return function(a,i){return r(e(a),e(i),t)};if(Array.isArray(e)){var n=Oe(r);return function(a,i){return n(e[0],e,1,t,r,a,i)}}var o=Z(e);return q(o.sortBy,o.comparer||r,o.order)}var y=function(e,r,t,n){var o;return Array.isArray(r)?(Array.isArray(t)&&t.length<2&&(o=t,t=o[0]),r.sort(q(t,n,e))):r};function J(e){var r=V(e.comparer);return function(t){var n=Array.isArray(t)&&!e.inPlaceSorting?t.slice():t;return{asc:function(o){return y(1,n,o,r)},desc:function(o){return y(-1,n,o,r)},by:function(o){return y(1,n,o,r)}}}}var K=function(e,r,t){return e==null?t:r==null?-t:typeof e!=typeof r?typeof e<typeof r?-1:1:e<r?-1:e>r?1:0},W=J({comparer:K});J({comparer:K,inPlaceSorting:!0});function T(e,r){const{deep:t=!1}=r||{};let n=Object.entries(e);return t&&(n=n.map(o=>E(o[1])?[o[0],T(o[1],r)]:G(o[1])?[o[0],L(o[1],r)]:o)),Object.fromEntries(W(n).asc(([o])=>o))}function L(e,r){const{deep:t=!1}=r||{};return t&&(e=e.map(n=>E(n)?T(n,r):G(n)?L(n,r):n)),W(e).asc()}async function Ae(e,r){const{sort:t=!1,deepSort:n=!1}=r||{};if(Ie(e))throw new Error("Cannot sha256 a symbol");return E(e)?_(JSON.stringify(t||n?T(e,{deep:n}):e)):G(e)?_(JSON.stringify(t||n?L(e,{deep:n}):e)):_(`${e}`)}const Pe="https://github.com/alist-org/alist";async function je(e){return await Ae(`${e}-${Pe}`)}const Ee=H('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="896" width="967.8852157128662"><defs><path id="path-2" opacity="1" fill-rule="evenodd" d="M896,448 C1142.6325445712241,465.5747656464056 695.2579309733121,896 448,896 C200.74206902668806,896 5.684341886080802e-14,695.2579309733121 0,448.0000000000001 C0,200.74206902668806 200.74206902668791,5.684341886080802e-14 447.99999999999994,0 C695.2579309733121,0 475,418 896,448Z"></path><linearGradient id="linearGradient-3" x1="0.5" y1="0" x2="0.5" y2="1"><stop offset="0" stop-opacity="1"></stop><stop offset="1" stop-opacity="1"></stop></linearGradient></defs><g opacity="1"><use xlink:href="#path-2" fill="url(#linearGradient-3)" fill-opacity="1"></use></g></svg>'),Ge=e=>{const r=z({startColor:"#28aff0",endColor:"#120fc4"},e);return(()=>{const t=Ee.cloneNode(!0),n=t.firstChild,o=n.firstChild,a=o.nextSibling,i=a.firstChild,c=i.nextSibling;return D(l=>{const u=r.startColor,f=r.endColor;return u!==l._v$&&m(i,"stop-color",l._v$=u),f!==l._v$2&&m(c,"stop-color",l._v$2=f),l},{_v$:void 0,_v$2:void 0}),t})()},Te=H('<svg height="1337" width="1337"><defs><path id="path-1" opacity="1" fill-rule="evenodd" d="M1337,668.5 C1337,1037.455193874239 1037.455193874239,1337 668.5,1337 C523.6725684305388,1337 337,1236 370.50000000000006,1094 C434.03835568300906,824.6732385973953 6.906089672974592e-14,892.6277623047779 0,668.5000000000001 C0,299.5448061257611 299.5448061257609,1.1368683772161603e-13 668.4999999999999,0 C1037.455193874239,0 1337,299.544806125761 1337,668.5Z"></path><linearGradient id="linearGradient-2" x1="0.79" y1="0.62" x2="0.21" y2="0.86"><stop offset="0" stop-opacity="1"></stop><stop offset="1" stop-opacity="1"></stop></linearGradient></defs><g opacity="1"><use xlink:href="#path-1" fill="url(#linearGradient-2)" fill-opacity="1"></use></g></svg>'),Le=e=>{const r=z({startColor:"#28aff0",endColor:"#120fc4"},e);return(()=>{const t=Te.cloneNode(!0),n=t.firstChild,o=n.firstChild,a=o.nextSibling,i=a.firstChild,c=i.nextSibling;return D(l=>{const u=r.startColor,f=r.endColor;return u!==l._v$&&m(i,"stop-color",l._v$=u),f!==l._v$2&&m(c,"stop-color",l._v$2=f),l},{_v$:void 0,_v$2:void 0}),t})()},Ne=()=>{const e=k("#a9c6ff","#062b74");return s($,{get bgColor(){return e()},pos:"fixed",top:"0",left:"0",overflow:"hidden",zIndex:"-1",w:"100vw",h:"100vh",get children(){return[s($,{pos:"absolute",right:{"@initial":"-100px","@sm":"-300px"},top:{"@initial":"-1170px","@sm":"-900px"},get children(){return s(Le,{})}}),s($,{pos:"absolute",left:{"@initial":"-100px","@sm":"-200px"},bottom:{"@initial":"-760px","@sm":"-400px"},get children(){return s(Ge,{})}})]}})},Me=()=>{const e=ee("sso_login_enabled"),r=I("sso_login_platform"),{searchParams:t,to:n}=U();function o(a){const i=a.data;i.token&&(O(i.token),n(decodeURIComponent(t.redirect||A||"/"),!0))}if(window.addEventListener("message",o),te(()=>{window.removeEventListener("message",o)}),e){const a=()=>{const c=F.getUri()+"/auth/sso?method=sso_get_token";window.open(c,"authPopup","width=500,height=600")};let i;switch(r){case"Github":i=se;break;case"Microsoft":i=xe;break;case"Google":i=ie;break;case"Dingtalk":i=oe;break;default:i=ne}return s(re,{cursor:"pointer",boxSize:"$8",as:i,p:"$0_5",onclick:a})}},De=()=>{const e=I("logo").split(`
`),r=k(e[0],e.pop()),t=ae(),n=le(()=>`${t("login.login_to")} ${I("site_title")}`);Se(n);const o=k("white","$neutral1"),[a,i]=h(localStorage.getItem("username")||""),[c,l]=h(localStorage.getItem("password")||""),[u,f]=h(""),[d,p]=ce("remember-pwd","false"),[X,Q]=ue(async()=>F.post("/auth/login/hash",{username:a(),password:await je(c()),otp_code:u()})),{searchParams:N,to:M}=U(),w=async()=>{d()==="true"?(localStorage.setItem("username",a()),localStorage.setItem("password",c())):(localStorage.removeItem("username"),localStorage.removeItem("password"));const g=await Q();Ce(g,b=>{R.success(t("login.success")),O(b.token),M(decodeURIComponent(N.redirect||A||"/"),!0)},(b,B)=>{!v()&&B===402?Y(!0):R.error(b)})},[v,Y]=h(!1);return s($e,{zIndex:"1",w:"$full",h:"100vh",get children(){return[s(fe,{get bgColor(){return o()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"364px"},spacing:"$4",get children(){return[s(C,{alignItems:"center",justifyContent:"space-around",get children(){return[s(ge,{mr:"$2",boxSize:"$12",get src(){return r()}}),s(de,{color:"$info9",fontSize:"$2xl",get children(){return n()}})]}}),s(pe,{get when(){return!v()},get fallback(){return s(x,{id:"totp",name:"otp",get placeholder(){return t("login.otp-tips")},get value(){return u()},onInput:g=>f(g.currentTarget.value),onKeyDown:g=>{g.key==="Enter"&&w()}})},get children(){return[s(x,{name:"username",get placeholder(){return t("login.username-tips")},get value(){return a()},onInput:g=>i(g.currentTarget.value)}),s(x,{name:"password",get placeholder(){return t("login.password-tips")},type:"password",get value(){return c()},onInput:g=>l(g.currentTarget.value),onKeyDown:g=>{g.key==="Enter"&&w()}}),s(C,{px:"$1",w:"$full",fontSize:"$sm",color:"$neutral10",justifyContent:"space-between",alignItems:"center",get children(){return[s(he,{get checked(){return d()==="true"},onChange:()=>p(d()==="true"?"false":"true"),get children(){return t("login.remember")}}),s(me,{as:"a",target:"_blank",get href(){return t("login.forget_url")},get children(){return t("login.forget")}})]}})]}}),s(we,{w:"$full",spacing:"$2",get children(){return[s(S,{colorScheme:"primary",w:"$full",onClick:()=>{v()?f(""):(i(""),l(""))},get children(){return t("login.clear")}}),s(S,{w:"$full",get loading(){return X()},onClick:w,get children(){return t("login.login")}})]}}),s(S,{w:"$full",colorScheme:"accent",onClick:()=>{O(),M(decodeURIComponent(N.redirect||A||"/"),!0)},get children(){return t("login.use_guest")}}),s(C,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[s(ve,{}),s(be,{}),s(Me,{})]}})]}}),s(Ne,{})]}})};export{De as default};
