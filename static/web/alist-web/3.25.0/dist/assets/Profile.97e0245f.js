import{d as x,u as y,e as g,a4 as s,a as L,bj as v,i as A,j as e,r as o,a3 as m,c6 as M,c7 as R,c8 as j,c9 as E,a1 as i,aP as C,br as k,ca as S,bd as h,b1 as p,I as f,F as T,B as c,aj as H,as as G,cb as _,x as J,ap as V,X as W,bJ as X,n as I,bp as q}from"./index.be808c1f.js";import{o as z}from"./index.3f8a9893.js";import{L as D}from"./index.46287c3f.js";const K=r=>e(X,{get colorScheme(){return r.can?"success":"danger"},get children(){return r.children}}),Y=()=>{const r=x();z("manage.sidemenu.profile");const{to:u}=y(),[l,P]=g(s().username),[a,B]=g(""),[w,F]=g(""),[b,U]=L(n=>v.post("/me/update",{username:n?s().username:l(),password:n?"":a(),sso_id:s().sso_id})),d=async n=>{if(a()&&a()!==w()){I.warning(r("users.confirm_password_not_same"));return}const t=await U(n);q(t,()=>{_({...s(),username:l()}),n?u(""):(I.success(r("users.update_profile_success")),u(`/@login?redirect=${encodeURIComponent(location.pathname)}`))})};function $(n){const t=n.data;t.sso_id&&(_({...s(),sso_id:t.sso_id}),d(!0))}return window.addEventListener("message",$),A(()=>{window.removeEventListener("message",$)}),e(W,{w:"$full",spacing:"$4",alignItems:"start",get children(){return[e(o,{get when(){return!m.is_guest(s())},get fallback(){return[e(M,{status:"warning",flexDirection:{"@initial":"column","@lg":"row"},get children(){return[e(R,{mr:"$2_5"}),e(j,{mr:"$2_5",get children(){return r("users.guest-tips")}}),e(E,{get children(){return r("users.modify_nothing")}})]}}),e(i,{spacing:"$2",get children(){return[e(C,{get children(){return r("global.have_account")}}),e(C,{color:"$info9",as:D,get href(){return`/@login?redirect=${encodeURIComponent(location.pathname)}`},get children(){return r("global.go_login")}})]}})]},get children(){return[e(k,{get children(){return r("users.update_profile")}}),e(S,{gap:"$2",columns:{"@initial":1,"@md":2},get children(){return e(h,{get children(){return[e(p,{for:"username",get children(){return r("users.change_username")}}),e(f,{id:"username",get value(){return l()},onInput:n=>{P(n.currentTarget.value)}})]}})}}),e(S,{gap:"$2",columns:{"@initial":1,"@md":2},get children(){return[e(h,{get children(){return[e(p,{for:"password",get children(){return r("users.change_password")}}),e(f,{id:"password",type:"password",placeholder:"********",get value(){return a()},onInput:n=>{B(n.currentTarget.value)}}),e(T,{get children(){return r("users.change_password-tips")}})]}}),e(h,{get children(){return[e(p,{for:"confirm-password",get children(){return r("users.confirm_password")}}),e(f,{id:"confirm-password",type:"password",placeholder:"********",get value(){return w()},onInput:n=>{F(n.currentTarget.value)}}),e(T,{get children(){return r("users.confirm_password-tips")}})]}})]}}),e(i,{spacing:"$2",get children(){return[e(c,{get loading(){return b()},onClick:[d,!1],get children(){return r("global.save")}}),e(o,{get when(){return!s().otp},get children(){return e(c,{colorScheme:"accent",onClick:()=>{u("/@manage/2fa")},get children(){return r("users.enable_2fa")}})}})]}})]}}),e(o,{get when(){return H(()=>!!G("sso_login_enabled"),!0)()&&!m.is_guest(s())},get children(){return[e(k,{get children(){return r("users.sso_login")}}),e(i,{spacing:"$2",get children(){return e(o,{get when(){return s().sso_id},get fallback(){return e(c,{onClick:()=>{v.getUri()+""},get children(){return r("users.connect_sso")}})},get children(){return e(c,{colorScheme:"danger",get loading(){return b()},onClick:()=>{_({...s(),sso_id:""}),d(!0)},get children(){return r("users.disconnect_sso")}})}})}})]}}),e(i,{wrap:"wrap",gap:"$2",mt:"$2",get children(){return e(J,{each:V,children:(n,t)=>e(K,{get can(){return m.can(s(),t())},get children(){return r(`users.permissions.${n}`)}})})}})]}})};export{Y as default};
