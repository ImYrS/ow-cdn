import{u as B,d as p,a2 as n,a as F,b6 as b,c1 as g,e,k as s,a1 as f,c2 as U,c3 as P,c4 as x,c5 as y,$ as a,bc as _,bf as w,c6 as A,a_ as $,aY as k,I as v,F as M,B as i,ap as R,t as H,am as L,V as D,bv as V,bd as G,n as N}from"./index.56603356.js";import{u as W}from"./useT.303c7e81.js";import{b as Y}from"./useTitle.f1b35a2e.js";import{L as j}from"./index.f1ab4103.js";const q=r=>e(V,{get colorScheme(){return r.can?"success":"danger"},get children(){return r.children}}),O=()=>{const r=W();Y("manage.sidemenu.profile");const{to:u,searchParams:S}=B(),[c,C]=p(n().username),[d,I]=p(""),[h,T]=F(t=>b.post("/me/update",{username:t?n().username:c(),password:t?"":d(),github_id:n().github_id})),o=async t=>{const l=await T(t);G(l,()=>{g({...n(),username:c()}),t?u(""):(N.success(r("users.update_profile_success")),u(`/@login?redirect=${encodeURIComponent(location.pathname)}`))})},m=S.githubID;return m&&(g({...n(),github_id:Number(m)}),o(!0)),e(D,{w:"$full",spacing:"$4",alignItems:"start",get children(){return[e(s,{get when(){return!f.is_guest(n())},get fallback(){return[e(U,{status:"warning",flexDirection:{"@initial":"column","@lg":"row"},get children(){return[e(P,{mr:"$2_5"}),e(x,{mr:"$2_5",get children(){return r("users.guest-tips")}}),e(y,{get children(){return r("users.modify_nothing")}})]}}),e(a,{spacing:"$2",get children(){return[e(_,{get children(){return r("global.have_account")}}),e(_,{color:"$info9",as:j,get href(){return`/@login?redirect=${encodeURIComponent(location.pathname)}`},get children(){return r("global.go_login")}})]}})]},get children(){return[e(w,{get children(){return r("users.update_profile")}}),e(A,{gap:"$2",columns:{"@initial":1,"@md":2},get children(){return[e($,{get children(){return[e(k,{for:"username",get children(){return r("users.change_username")}}),e(v,{id:"username",get value(){return c()},onInput:t=>{C(t.currentTarget.value)}})]}}),e($,{get children(){return[e(k,{for:"password",get children(){return r("users.change_password")}}),e(v,{id:"password",type:"password",placeholder:"********",get value(){return d()},onInput:t=>{I(t.currentTarget.value)}}),e(M,{get children(){return r("users.change_password-tips")}})]}})]}}),e(a,{spacing:"$2",get children(){return[e(i,{get loading(){return h()},onClick:[o,void 0],get children(){return r("global.save")}}),e(s,{get when(){return!n().otp},get children(){return e(i,{colorScheme:"accent",onClick:()=>{u("/@manage/2fa")},get children(){return r("users.enable_2fa")}})}})]}})]}}),e(s,{get when(){return R("github_login_enabled")},get children(){return[e(w,{get children(){return r("users.github_login")}}),e(a,{spacing:"$2",get children(){return e(s,{get when(){return n().github_id},get fallback(){return e(i,{onClick:()=>{window.location.href=b.getUri()+"/auth/github?callback_url="+window.location.href+"&method=get_github_id"},get children(){return r("users.connect_github")}})},get children(){return e(i,{colorScheme:"danger",get loading(){return h()},onClick:()=>{g({...n(),github_id:0}),o(!0)},get children(){return r("users.disconnect_github")}})}})}})]}}),e(a,{wrap:"wrap",gap:"$2",mt:"$2",get children(){return e(H,{each:L,children:(t,l)=>e(q,{get can(){return f.can(n(),l())},get children(){return r(`users.permissions.${t}`)}})})}})]}})};export{O as default};
